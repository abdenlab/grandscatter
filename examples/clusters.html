<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>5D Clusters - grandscatter</title>
<style>
	body {
		margin: 0;
		font-family: system-ui, sans-serif;
		background: #f5f5f5;
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 2rem;
	}
	h1 { margin-bottom: 0.5rem; }
	p { color: #666; margin-top: 0; }
	#plot {
		width: 1028px;
		height: 1028px;
		background: white;
		border: 1px solid #ddd;
		border-radius: 4px;
	}
	#controls {
		display: flex;
		gap: 2rem;
		margin-bottom: 1rem;
	}
	.control {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}
	.control label {
		min-width: 80px;
	}
	.control input[type="range"] {
		width: 150px;
	}
	.control .value {
		min-width: 40px;
		text-align: right;
		font-variant-numeric: tabular-nums;
	}
	#data-controls {
		margin-bottom: 1rem;
	}
	#data-controls label {
		margin-right: 0.5rem;
	}
	#data-controls select {
		padding: 0.25rem 0.5rem;
		font-size: 1rem;
	}
</style>
</head>
<body>
<h1>grandscatter</h1>
<p>Drag the axis handles to rotate the projection.</p>
<div id="data-controls">
	<label for="ndim">Dimensions:</label>
	<select id="ndim">
		<option value="2">2D</option>
		<option value="3" selected>3D</option>
		<option value="4">4D</option>
		<option value="5">5D</option>
	</select>
	<label for="projection">Projection:</label>
	<select id="projection">
		<option value="orthographic" selected>Orthographic</option>
		<option value="perspective">Perspective</option>
	</select>
</div>
<div id="controls">
	<div class="control">
		<label for="cameraZ">Camera Z:</label>
		<input type="range" id="cameraZ" min="-15" max="15" step="0.1" value="2">
		<span class="value" id="cameraZValue">5</span>
	</div>
	<div class="control">
		<label for="viewAngle">FOV:</label>
		<input type="range" id="viewAngle" min="1" max="179" step="1" value="90">
		<span class="value" id="viewAngleValue">90°</span>
	</div>
	<div class="control">
		<label for="pointSize">Point Size:</label>
		<input type="range" id="pointSize" min="1" max="50" step="1" value="20">
		<span class="value" id="pointSizeValue">20</span>
	</div>
	<div class="control">
		<label for="minDepthScale">Min Scale:</label>
		<input type="range" id="minDepthScale" min="0" max="1" step="0.05" value="0.1">
		<span class="value" id="minDepthScaleValue">0.1</span>
	</div>
	<div class="control">
		<label for="axisLength">Axis Length:</label>
		<input type="range" id="axisLength" min="0.5" max="5" step="0.1" value="2">
		<span class="value" id="axisLengthValue">2</span>
	</div>
</div>
<div id="plot"></div>
<script type="module">
import { Scatterplot } from "@grandscatter/core";

// Box-Muller transform for normal random numbers
function randn() {
	const u = 1 - Math.random();
	const v = Math.random();
	return Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
}

const N = 200; // points per cluster
const centers5D = [
	[2, 0, 0, 1, -1],  // Cluster A (red)
	[-1, 2, -1, 0, 1],  // Cluster B (blue)
	[0, -2, 2, -1, 0], // Cluster C (green)
];
const clusterNames = ["Cluster A", "Cluster B", "Cluster C"];
const colors = { "Cluster A": "#e41a1c", "Cluster B": "#377eb8", "Cluster C": "#4daf4a" };

function generateData(ndim) {
	const columns = {};
	for (let i = 0; i < ndim; i++) {
		columns[`x${i + 1}`] = [];
	}
	const labels = [];
	const keys = Object.keys(columns);

	for (let c = 0; c < centers5D.length; c++) {
		for (let i = 0; i < N; i++) {
			for (let d = 0; d < ndim; d++) {
				columns[keys[d]].push(centers5D[c][d] + randn() * 0.6);
			}
			labels.push(clusterNames[c]);
		}
	}

	// Convert to typed arrays
	for (const key of keys) {
		columns[key] = new Float64Array(columns[key]);
	}

	return { columns, labels, colors };
}

const plot = Scatterplot.create(document.getElementById("plot"), {
	basePointSize: 20,
});

// Slider elements
const cameraZInput = document.getElementById("cameraZ");
const cameraZValue = document.getElementById("cameraZValue");
const viewAngleInput = document.getElementById("viewAngle");
const viewAngleValue = document.getElementById("viewAngleValue");
const pointSizeInput = document.getElementById("pointSize");
const pointSizeValue = document.getElementById("pointSizeValue");
const minDepthScaleInput = document.getElementById("minDepthScale");
const minDepthScaleValue = document.getElementById("minDepthScaleValue");
const axisLengthInput = document.getElementById("axisLength");
const axisLengthValue = document.getElementById("axisLengthValue");
const ndimSelect = document.getElementById("ndim");
const projectionSelect = document.getElementById("projection");

// Sync all sliders to the plot's current values
function syncControls() {
	cameraZInput.value = plot.cameraZ;
	cameraZValue.textContent = plot.cameraZ.toFixed(1);
	viewAngleInput.value = plot.viewAngle;
	viewAngleValue.textContent = `${Math.round(plot.viewAngle)}°`;
	pointSizeInput.value = plot.basePointSize;
	pointSizeValue.textContent = plot.basePointSize;
	minDepthScaleInput.value = plot.minDepthScale;
	minDepthScaleValue.textContent = plot.minDepthScale;
	axisLengthInput.value = plot.axisLength;
	axisLengthValue.textContent = plot.axisLength.toFixed(1);
	projectionSelect.value = plot.projection;
}

plot.loadData(generateData(3));
syncControls();

// Wire up slider controls
cameraZInput.addEventListener("input", () => {
	const val = parseFloat(cameraZInput.value);
	plot.cameraZ = val;
	cameraZValue.textContent = val.toFixed(1);
});

viewAngleInput.addEventListener("input", () => {
	const val = parseFloat(viewAngleInput.value);
	plot.viewAngle = val;
	viewAngleValue.textContent = `${Math.round(val)}°`;
});

pointSizeInput.addEventListener("input", () => {
	const val = parseFloat(pointSizeInput.value);
	plot.basePointSize = val;
	pointSizeValue.textContent = val;
});

minDepthScaleInput.addEventListener("input", () => {
	const val = parseFloat(minDepthScaleInput.value);
	plot.minDepthScale = val;
	minDepthScaleValue.textContent = val;
});

axisLengthInput.addEventListener("input", () => {
	const val = parseFloat(axisLengthInput.value);
	plot.axisLength = val;
	axisLengthValue.textContent = val.toFixed(1);
});

ndimSelect.addEventListener("change", () => {
	const val = parseInt(ndimSelect.value, 10);
	plot.loadData(generateData(val));
	syncControls();
});

projectionSelect.addEventListener("change", () => {
	plot.projection = projectionSelect.value;
});
</script>
</body>
</html>
